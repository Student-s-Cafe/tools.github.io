<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MultiTool | All-in-One Web Utility Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="./icon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom CSS */
        :root {
            --primary: #3b82f6;
            /* blue-500 */
            --primary-hover: #2563eb;
            /* blue-600 */
            --secondary: #10b981;
            /* emerald-500 */
            --accent: #6366f1;
            /* indigo-500 */
            --dark: #1e293b;
            /* slate-800 */
            --light: #f8fafc;
            /* slate-50 */
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--light);
            color: var(--dark);
        }

        .tool-card {
            transition: all 0.3s ease;
            transform: translateY(0);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            /* Prevent content overflow on transform */
        }

        .tool-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .tab-button {
            position: relative;
            border-bottom: 3px solid transparent;
            /* Add transparent border for layout consistency */
        }

        .tab-active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: 600;
        }

        .text-output {
            min-height: 150px;
            /* Adjusted min height */
            background-color: #f1f5f9;
            /* slate-100 */
            border-radius: 0.375rem;
            padding: 0.75rem;
            font-family: monospace;
            white-space: pre-wrap;
            /* Wrap text */
            word-wrap: break-word;
            /* Break long words - legacy */
            overflow-wrap: break-word;
            /* Break long words - standard */
            word-break: break-all;
            /* Force break any sequence of characters */
            border: 1px solid #e2e8f0;
            /* slate-200 */
        }

        .color-preview {
            width: 100%;
            height: 40px;
            border-radius: 0.375rem;
            border: 1px solid #e2e8f0;
            /* slate-200 */
        }

        /* Animation for tool switching */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            /* slate-100 */
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            /* slate-300 */
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
            /* slate-400 */
        }

        /* Utility class for simpler scrollbar hiding */
        .scrollbar-hidden::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hidden {
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        /* Style for file input */
        input[type="file"] {
            display: none;
        }

        .file-input-label {
            cursor: pointer;
            display: inline-block;
            padding: 0.5rem 1rem;
            background-color: var(--primary);
            color: white;
            border-radius: 0.375rem;
            transition: background-color 0.2s ease;
        }

        .file-input-label:hover {
            background-color: var(--primary-hover);
        }

        .file-drop-zone {
            border: 2px dashed #cbd5e1;
            /* slate-300 */
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1rem;
            transition: border-color 0.2s ease, background-color 0.2s ease;
        }

        .file-drop-zone.dragover {
            border-color: var(--primary);
            background-color: #eff6ff;
            /* blue-50 */
        }

        /* Diff styles */
        .diff-output {
            font-family: monospace;
            white-space: pre-wrap; /* Allow text to wrap */
            overflow-y: auto; /* Enable vertical scrolling */
            max-height: 150px; /* Limit height to ensure scrolling */
            background-color: #f1f5f9; /* slate-100 */
            border-radius: 0.375rem;
            padding: 0.75rem;
            border: 1px solid #e2e8f0; /* slate-200 */
        }

        .diff-add {
            background-color: #dcfce7;
            color: #166534;
        }

        /* green-100 / green-800 */
        .diff-remove {
            background-color: #fee2e2;
            color: #991b1b;
            text-decoration: line-through;
        }

        /* red-100 / red-800 */
    </style>
</head>

<body class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <div class="w-10 h-10 rounded-md bg-blue-500 flex items-center justify-center">
                        <i class="fas fa-tools text-white text-xl"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-blue-600">MultiTool</h1>
                </div>
                <!-- Mobile Menu Button (optional functionality) -->
                <button class="md:hidden text-gray-700">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8">
        <!-- Tool Selector Tabs -->
        <div class="mb-8 border-b border-gray-200">
            <div class="flex space-x-6 md:space-x-8 overflow-x-auto pb-0 scrollbar-hidden">
                <!-- Added IDs for easier selection -->
                <button id="tab-text" onclick="switchTool('text')"
                    class="tab-button px-1 py-3 font-medium text-gray-500 hover:text-blue-600 whitespace-nowrap transition flex items-center active">
                    <i class="far fa-file-alt mr-2"></i> Text Tools
                </button>
                <button id="tab-image" onclick="switchTool('image')"
                    class="tab-button px-1 py-3 font-medium text-gray-500 hover:text-blue-600 whitespace-nowrap transition flex items-center">
                    <i class="far fa-image mr-2"></i> Image Tools
                </button>
                <button id="tab-data" onclick="switchTool('data')"
                    class="tab-button px-1 py-3 font-medium text-gray-500 hover:text-blue-600 whitespace-nowrap transition flex items-center">
                    <i class="fas fa-database mr-2"></i> Data Converters
                </button>
                <button id="tab-security" onclick="switchTool('security')"
                    class="tab-button px-1 py-3 font-medium text-gray-500 hover:text-blue-600 whitespace-nowrap transition flex items-center">
                    <i class="fas fa-lock mr-2"></i> Security
                </button>
                <button id="tab-pdf" onclick="switchTool('pdf')"
                    class="tab-button px-1 py-3 font-medium text-gray-500 hover:text-blue-600 whitespace-nowrap transition flex items-center">
                    <i class="far fa-file-pdf mr-2"></i> PDF Tools
                </button>
            </div>
        </div>

        <!-- Tool Content -->
        <div id="tool-content" class="fade-in">
            <!-- Text Tools (Default) -->
            <div id="text-tool" class="tool-section">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- Text Case Converter -->
                    <div class="tool-card bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Text Case Converter</h3>
                            <button
                                onclick="copyToClipboard(document.getElementById('case-converter-input').value, this)"
                                class="text-blue-500 hover:text-blue-700" title="Copy text">
                                <i class="far fa-copy"></i> <span
                                    class="copy-feedback hidden text-xs ml-1">Copied!</span>
                            </button>
                        </div>
                        <textarea id="case-converter-input"
                            class="w-full p-3 border border-gray-300 rounded-md mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Enter your text here..." rows="4"></textarea>
                        <div class="flex flex-wrap gap-2 mb-4">
                            <button onclick="convertCase('upper')"
                                class="px-3 py-1 bg-blue-100 text-blue-700 rounded-md text-sm hover:bg-blue-200 transition">UPPERCASE</button>
                            <button onclick="convertCase('lower')"
                                class="px-3 py-1 bg-blue-100 text-blue-700 rounded-md text-sm hover:bg-blue-200 transition">lowercase</button>
                            <button onclick="convertCase('title')"
                                class="px-3 py-1 bg-blue-100 text-blue-700 rounded-md text-sm hover:bg-blue-200 transition">Title
                                Case</button>
                            <button onclick="convertCase('sentence')"
                                class="px-3 py-1 bg-blue-100 text-blue-700 rounded-md text-sm hover:bg-blue-200 transition">Sentence
                                case</button>
                            <button onclick="convertCase('camel')"
                                class="px-3 py-1 bg-blue-100 text-blue-700 rounded-md text-sm hover:bg-blue-200 transition">camelCase</button>
                            <button onclick="convertCase('pascal')"
                                class="px-3 py-1 bg-blue-100 text-blue-700 rounded-md text-sm hover:bg-blue-200 transition">PascalCase</button>
                            <button onclick="convertCase('clear')"
                                class="px-3 py-1 bg-red-100 text-red-700 rounded-md text-sm hover:bg-red-200 transition">Clear</button>
                        </div>
                    </div>

                    <!-- Character Counter -->
                    <div class="tool-card bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Character & Word Counter</h3>
                            <button onclick="copyToClipboard(document.getElementById('counter-input').value, this)"
                                class="text-blue-500 hover:text-blue-700" title="Copy text">
                                <i class="far fa-copy"></i> <span
                                    class="copy-feedback hidden text-xs ml-1">Copied!</span>
                            </button>
                        </div>
                        <textarea id="counter-input"
                            class="w-full p-3 border border-gray-300 rounded-md mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Type or paste your text here..." rows="4"></textarea>
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div class="bg-gray-50 p-3 rounded-md">
                                <div class="text-2xl font-bold text-blue-600" id="char-count">0</div>
                                <div class="text-sm text-gray-500">Characters</div>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-md">
                                <div class="text-2xl font-bold text-blue-600" id="word-count">0</div>
                                <div class="text-sm text-gray-500">Words</div>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-md">
                                <div class="text-2xl font-bold text-blue-600" id="line-count">0</div>
                                <div class="text-sm text-gray-500">Lines</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Lorem Ipsum Generator -->
                    <div class="tool-card bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Lorem Ipsum Generator</h3>
                            <button onclick="copyToClipboard(document.getElementById('lorem-output').textContent, this)"
                                class="text-blue-500 hover:text-blue-700" title="Copy generated text">
                                <i class="far fa-copy"></i> <span
                                    class="copy-feedback hidden text-xs ml-1">Copied!</span>
                            </button>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="lorem-paragraphs"
                                    class="block text-sm font-medium text-gray-700 mb-1">Paragraphs</label>
                                <input id="lorem-paragraphs" type="number" min="1" max="50" value="3"
                                    class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="lorem-sentences"
                                    class="block text-sm font-medium text-gray-700 mb-1">Sentences/Para</label>
                                <input id="lorem-sentences" type="number" min="1" max="20" value="5"
                                    class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="flex items-center">
                                <input id="lorem-start" type="checkbox"
                                    class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700">Start with "Lorem ipsum dolor sit
                                    amet..."</span>
                            </label>
                        </div>
                        <button onclick="generateLoremIpsum()"
                            class="w-full py-2 mb-4 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">Generate
                            Text</button>
                        <div id="lorem-output" class="text-output text-sm">Generated text will appear here...</div>
                    </div>

                    <!-- Text Diff Checker -->
                    <div class="tool-card bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Text Diff Checker (Line by Line)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="diff-original" class="block text-sm font-medium text-gray-700 mb-1">Original
                                    Text</label>
                                <textarea id="diff-original"
                                    class="w-full p-2 border border-gray-300 rounded-md text-sm font-mono focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                                    rows="4"></textarea>
                            </div>
                            <div>
                                <label for="diff-changed" class="block text-sm font-medium text-gray-700 mb-1">Changed
                                    Text</label>
                                <textarea id="diff-changed"
                                    class="w-full p-2 border border-gray-300 rounded-md text-sm font-mono focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                                    rows="4"></textarea>
                            </div>
                        </div>
                        <button onclick="findTextDifferences()"
                            class="py-2 px-4 mb-4 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">Find
                            Differences</button>
                        <div id="diff-output" class="text-output text-sm diff-output">Differences will be highlighted
                            here...</div>
                    </div>
                </div>
            </div>

            <!-- Image Tools (Hidden by default) -->
            <div id="image-tool" class="tool-section hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Image Compressor -->
                    <div class="tool-card bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center mb-4">
                            <div
                                class="w-12 h-12 rounded-lg bg-purple-100 flex items-center justify-center mr-4 shrink-0">
                                <i class="fas fa-compress-alt text-purple-600 text-xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800">Image Compressor (JPG/WEBP)</h3>
                        </div>
                        <div id="compressor-drop-zone" class="file-drop-zone">
                            <i class="far fa-image text-4xl text-purple-500 mb-3"></i>
                            <p class="text-gray-600 mb-3">Drag & drop JPG/PNG/WEBP here or</p>
                            <label for="compressor-file-input" class="file-input-label">
                                <i class="fas fa-plus mr-2"></i> Select Image
                            </label>
                            <input type="file" id="compressor-file-input" accept="image/jpeg,image/png,image/webp">
                            <p id="compressor-file-name" class="text-sm text-gray-500 mt-3 break-all"></p>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Convert to:</label>
                            <div class="flex space-x-2">
                                <label class="flex items-center">
                                    <input type="radio" name="compressFormat" value="image/jpeg" checked
                                        class="mr-1 text-blue-600 focus:ring-blue-500"> JPG
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="compressFormat" value="image/webp"
                                        class="mr-1 text-blue-600 focus:ring-blue-500"> WEBP
                                </label>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Quality: <span
                                    id="quality-value" class="font-semibold">75</span>%</label>
                            <input type="range" min="10" max="95" value="75"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
                                id="quality-slider">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>Lower Quality</span>
                                <span>Higher Quality</span>
                            </div>
                        </div>
                        <button id="compress-button" onclick="compressImage()"
                            class="w-full py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled>
                            <i class="fas fa-compress-alt mr-2"></i> Compress Image
                        </button>
                        <div id="compressor-output" class="mt-4 text-sm"></div>
                    </div>

                    <!-- Image Converter -->
                    <div class="tool-card bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center mb-4">
                            <div
                                class="w-12 h-12 rounded-lg bg-green-100 flex items-center justify-center mr-4 shrink-0">
                                <i class="fas fa-exchange-alt text-green-600 text-xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800">Image Format Converter</h3>
                        </div>
                        <div id="converter-drop-zone" class="file-drop-zone">
                            <i class="far fa-image text-4xl text-green-500 mb-3"></i>
                            <p class="text-gray-600 mb-3">Drag & drop image here or</p>
                            <label for="converter-file-input" class="file-input-label">
                                <i class="fas fa-plus mr-2"></i> Select Image
                            </label>
                            <input type="file" id="converter-file-input" accept="image/*">
                            <p id="converter-file-name" class="text-sm text-gray-500 mt-3 break-all"></p>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Convert to:</label>
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                                <button onclick="setConversionFormat('image/jpeg', this)"
                                    class="convert-format-btn py-2 px-1 border border-gray-300 rounded-md text-sm font-medium hover:bg-gray-50 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">JPG</button>
                                <button onclick="setConversionFormat('image/png', this)"
                                    class="convert-format-btn py-2 px-1 border border-gray-300 rounded-md text-sm font-medium hover:bg-gray-50 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 active">PNG</button>
                                <button onclick="setConversionFormat('image/webp', this)"
                                    class="convert-format-btn py-2 px-1 border border-gray-300 rounded-md text-sm font-medium hover:bg-gray-50 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">WEBP</button>
                                <button onclick="setConversionFormat('image/gif', this)"
                                    class="convert-format-btn py-2 px-1 border border-gray-300 rounded-md text-sm font-medium hover:bg-gray-50 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">GIF</button>
                            </div>
                            <input type="hidden" id="converter-target-format" value="image/png">
                            <!-- Store selected format -->
                        </div>
                        <button id="convert-button" onclick="convertImage()"
                            class="w-full py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled>
                            <i class="fas fa-exchange-alt mr-2"></i> Convert Image
                        </button>
                        <div id="converter-output" class="mt-4 text-sm"></div>
                    </div>
                </div>
            </div>

            <!-- Data Tools (Hidden by default) -->
            <div id="data-tool" class="tool-section hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- JSON to CSV -->
                    <div class="tool-card bg-white rounded-xl shadow-sm p-6 flex flex-col">
                        <div class="flex items-center mb-4">
                            <div
                                class="w-12 h-12 rounded-lg bg-yellow-100 flex items-center justify-center mr-4 shrink-0">
                                <i class="fas fa-code text-yellow-600 text-xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800">JSON to CSV Converter</h3>
                        </div>
                        <textarea id="json-input"
                            class="flex-grow w-full p-3 border border-gray-300 rounded-md mb-4 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder='Paste JSON array of objects here, e.g., [{"name":"John", "age":30}, {"name":"Jane", "age":25}]'
                            rows="6"></textarea>
                        <div class="flex justify-between items-center mb-4 text-xs">
                            <div class="text-gray-500 flex items-center">
                                <i class="fas fa-info-circle mr-1"></i> Accepts an array of flat objects.
                            </div>
                            <button onclick="loadSampleJson()"
                                class="px-3 py-1 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 text-xs">
                                <i class="fas fa-random mr-1"></i> Sample
                            </button>
                        </div>
                        <button onclick="convertJsonToCsv()"
                            class="w-full py-2 mb-4 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
                            Convert to CSV
                        </button>
                        <div class="flex items-center justify-between mb-2">
                            <label class="block text-sm font-medium text-gray-700">CSV Output</label>
                            <button onclick="copyToClipboard(document.getElementById('csv-output').textContent, this)"
                                class="text-blue-500 hover:text-blue-700 text-xs" title="Copy CSV">
                                <i class="far fa-copy"></i> <span
                                    class="copy-feedback hidden text-xs ml-1">Copied!</span>
                            </button>
                        </div>
                        <div id="csv-output" class="text-output text-sm">CSV output will appear here...</div>
                        <div id="json-csv-error" class="text-red-600 text-xs mt-2"></div>
                    </div>

                    <!-- Base64 Encoder/Decoder -->
                    <div class="tool-card bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center mb-4">
                            <div
                                class="w-12 h-12 rounded-lg bg-indigo-100 flex items-center justify-center mr-4 shrink-0">
                                <i class="fas fa-sync-alt text-indigo-600 text-xl"></i> <!-- Changed Icon -->
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800">Base64 Encoder/Decoder</h3>
                        </div>
                        <div class="mb-3">
                            <label for="base64-input" class="block text-sm font-medium text-gray-700 mb-1">Input
                                Text</label>
                            <textarea id="base64-input"
                                class="w-full p-3 border border-gray-300 rounded-md font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="Enter text to encode or Base64 to decode" rows="4"></textarea>
                        </div>
                        <div class="flex items-center justify-center mb-3">
                            <button onclick="swapBase64()"
                                class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition text-gray-600"
                                title="Swap Input/Output">
                                <i class="fas fa-exchange-alt"></i>
                            </button>
                        </div>
                        <div class="mb-4">
                            <div class="flex items-center justify-between mb-1">
                                <label for="base64-output"
                                    class="block text-sm font-medium text-gray-700">Output</label>
                                <button onclick="copyToClipboard(document.getElementById('base64-output').value, this)"
                                    class="text-blue-500 hover:text-blue-700 text-xs" title="Copy Output">
                                    <i class="far fa-copy"></i> <span
                                        class="copy-feedback hidden text-xs ml-1">Copied!</span>
                                </button>
                            </div>
                            <textarea id="base64-output"
                                class="w-full p-3 border border-gray-300 rounded-md font-mono text-sm bg-gray-50 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                                rows="4" readonly></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="base64Encode()"
                                class="py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
                                <i class="fas fa-lock mr-2"></i> Encode
                            </button>
                            <button onclick="base64Decode()"
                                class="py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition">
                                <i class="fas fa-lock-open mr-2"></i> Decode
                            </button>
                        </div>
                        <div id="base64-error" class="text-red-600 text-xs mt-2"></div>
                    </div>
                </div>
            </div>

            <!-- Security Tools (Hidden by default) -->
            <div id="security-tool" class="tool-section hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Password Generator -->
                    <div class="tool-card bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center mb-4">
                            <div
                                class="w-12 h-12 rounded-lg bg-amber-100 flex items-center justify-center mr-4 shrink-0">
                                <i class="fas fa-key text-amber-600 text-xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800">Password Generator</h3>
                        </div>
                        <div class="mb-4">
                            <div
                                class="flex items-center justify-between bg-gray-100 p-3 rounded-md mb-3 border border-gray-200">
                                <span id="generated-password"
                                    class="font-mono text-sm sm:text-base break-all mr-2">Click Generate...</span>
                                <button
                                    onclick="copyToClipboard(document.getElementById('generated-password').textContent, this)"
                                    class="text-blue-500 hover:text-blue-700 shrink-0" title="Copy Password">
                                    <i class="far fa-copy"></i> <span
                                        class="copy-feedback hidden text-xs ml-1">Copied!</span>
                                </button>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <label for="length-slider" class="text-sm font-medium text-gray-700">Length: <span
                                        id="password-length-display">16</span></label>
                                <div id="password-strength-indicator" class="flex items-center">
                                    <span class="text-sm font-medium mr-1">Strength</span>
                                    <div class="flex">
                                        <div class="strength-bar w-3 h-1 bg-gray-300 mx-px rounded-full"></div>
                                        <div class="strength-bar w-3 h-1 bg-gray-300 mx-px rounded-full"></div>
                                        <div class="strength-bar w-3 h-1 bg-gray-300 mx-px rounded-full"></div>
                                        <div class="strength-bar w-3 h-1 bg-gray-300 mx-px rounded-full"></div>
                                    </div>
                                </div>
                            </div>
                            <input type="range" min="8" max="48" value="16"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
                                id="length-slider">
                            <div class="flex justify-between text-xs text-gray-500 mt-1 px-1">
                                <span>8</span>
                                <span>48</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-x-4 gap-y-2 mb-4">
                            <label class="flex items-center">
                                <input id="pw-opt-upper" type="checkbox" checked
                                    class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700">Uppercase (A-Z)</span>
                            </label>
                            <label class="flex items-center">
                                <input id="pw-opt-lower" type="checkbox" checked
                                    class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700">Lowercase (a-z)</span>
                            </label>
                            <label class="flex items-center">
                                <input id="pw-opt-numbers" type="checkbox" checked
                                    class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700">Numbers (0-9)</span>
                            </label>
                            <label class="flex items-center">
                                <input id="pw-opt-symbols" type="checkbox" checked
                                    class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700">Symbols (!@#$)</span>
                            </label>
                        </div>
                        <button onclick="generateAndDisplayPassword()"
                            class="w-full py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
                            <i class="fas fa-redo mr-2"></i> Generate Password
                        </button>
                    </div>

                    <!-- Password Strength Checker -->
                    <div class="tool-card bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-lg bg-red-100 flex items-center justify-center mr-4 shrink-0">
                                <i class="fas fa-shield-alt text-red-600 text-xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800">Password Strength Checker</h3>
                        </div>
                        <div class="mb-4 relative">
                            <label for="strength-check-input" class="block text-sm font-medium text-gray-700 mb-1">Enter
                                password to check</label>
                            <input type="password" id="strength-check-input"
                                class="w-full p-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="Your password...">
                            <button type="button" onclick="togglePasswordVisibility('strength-check-input', this)"
                                class="absolute inset-y-0 right-0 top-6 px-3 flex items-center text-gray-500 hover:text-blue-600">
                                <i class="far fa-eye"></i>
                            </button>
                        </div>
                        <div id="strength-results" class="space-y-3 mb-4 hidden">
                            <!-- Strength Bar -->
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-medium text-gray-700">Overall Strength</span>
                                    <span id="strength-text" class="text-sm font-semibold"></span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div id="strength-bar-overall"
                                        class="h-2 rounded-full transition-all duration-300 ease-out" style="width: 0%">
                                    </div>
                                </div>
                            </div>
                            <!-- Feedback -->
                            <div id="strength-feedback" class="text-xs text-gray-600 space-y-1">
                                <!-- Feedback messages appear here -->
                            </div>
                        </div>
                        <div id="strength-initial-message" class="text-sm text-gray-500 mb-4">
                            Enter a password to see its strength analysis.
                        </div>
                        <button onclick="checkPasswordStrength()"
                            class="w-full py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
                            Check Strength
                        </button>
                    </div>
                </div>
            </div>

            <!-- PDF Tools (Hidden by default - Placeholders) -->
            <div id="pdf-tool" class="tool-section hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- PDF to Word -->
                    <div class="tool-card bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-lg bg-red-100 flex items-center justify-center mr-4 shrink-0">
                                <i class="far fa-file-word text-red-600 text-xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800">PDF to Word Converter</h3>
                        </div>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center mb-4 bg-gray-50">
                            <i class="far fa-file-pdf text-4xl text-red-500 mb-3"></i>
                            <p class="text-gray-600 mb-3 font-semibold">Feature Coming Soon!</p>
                            <p class="text-sm text-gray-500 mb-4">PDF to Word conversion requires complex processing
                                typically done on a server.</p>
                            <button
                                class="px-4 py-2 bg-blue-600 text-white rounded-md opacity-50 cursor-not-allowed flex items-center justify-center mx-auto">
                                <i class="fas fa-cogs mr-2"></i> Under Development
                            </button>
                        </div>
                        <div class="text-xs text-center text-gray-500">
                            This tool cannot be fully implemented using only client-side JavaScript due to the
                            complexity of PDF parsing and DOCX generation.
                        </div>
                    </div>

                    <!-- PDF Merge -->
                    <div class="tool-card bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center mb-4">
                            <div
                                class="w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center mr-4 shrink-0">
                                <i class="fas fa-object-ungroup text-blue-600 text-xl"></i> <!-- Changed icon -->
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800">PDF Merger</h3>
                        </div>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center mb-4 bg-gray-50">
                            <i class="far fa-file-pdf text-4xl text-blue-500 mb-3"></i>
                            <p class="text-gray-600 mb-3 font-semibold">Feature Coming Soon!</p>
                            <p class="text-sm text-gray-500 mb-4">Merging PDF files accurately requires server-side
                                processing or specialized libraries.</p>
                            <button
                                class="px-4 py-2 bg-blue-600 text-white rounded-md opacity-50 cursor-not-allowed flex items-center justify-center mx-auto">
                                <i class="fas fa-cogs mr-2"></i> Under Development
                            </button>
                        </div>
                        <div class="text-xs text-center text-gray-500">
                            This tool cannot be fully implemented using only client-side JavaScript due to the
                            complexity of manipulating PDF structures.
                        </div>
                    </div>
                </div>
            </div>

        </div> <!-- End tool-content -->
    </main>

    <!-- Footer -->
    <footer class="bg-slate-100 border-t border-gray-200 mt-12 py-6">
        <div class="container mx-auto px-4 text-center text-sm text-gray-600">
            Â© 2023 MultiTool. All rights reserved. A simple utility platform.
            <p class="text-xs mt-1">Note: Some features like PDF manipulation are limited in this client-side-only
                version.</p>
        </div>
    </footer>


    <script>
        // --- Global Variables ---
        let currentTool = 'text';
        let imageConverterFile = null;
        let imageCompressorFile = null;
        let imageConverterFormat = 'image/png'; // Default conversion format

        // --- Utility Functions ---
        function copyToClipboard(text, buttonElement) {
            if (!text || text === 'Click Generate...' || text === 'Generated text will appear here...' || text === 'CSV output will appear here...' || text === 'Differences will be highlighted here...') {
                alert('Nothing to copy yet!');
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                const feedback = buttonElement.querySelector('.copy-feedback');
                if (feedback) {
                    feedback.classList.remove('hidden');
                    setTimeout(() => {
                        feedback.classList.add('hidden');
                    }, 1500);
                }
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy text.');
            });
        }

        function togglePasswordVisibility(inputId, buttonElement) {
            const input = document.getElementById(inputId);
            const icon = buttonElement.querySelector('i');
            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
            } else {
                input.type = "password";
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
            }
        }

        // --- Tool Switching ---
        function switchTool(toolName) {
            if (currentTool === toolName) return; // No need to switch if already active

            // Hide current tool section
            const currentSection = document.getElementById(`${currentTool}-tool`);
            if (currentSection) {
                currentSection.classList.add('hidden');
            }

            // Show selected tool section
            const newSection = document.getElementById(`${toolName}-tool`);
            if (newSection) {
                newSection.classList.remove('hidden');
                // Add fade-in animation
                newSection.classList.remove('fade-in'); // Remove class first to reset animation
                void newSection.offsetWidth; // Trigger reflow
                newSection.classList.add('fade-in');
            }

            // Update active tab
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('tab-active', 'text-blue-600', 'font-semibold'); // Ensure removal of active styles
                button.classList.add('text-gray-500');
            });
            const activeTabButton = document.getElementById(`tab-${toolName}`);
            if (activeTabButton) {
                activeTabButton.classList.add('tab-active', 'text-blue-600', 'font-semibold');
                activeTabButton.classList.remove('text-gray-500');
            }

            currentTool = toolName;
        }


        // --- Text Tool Functions ---
        const caseConverterInput = document.getElementById('case-converter-input');
        function convertCase(type) {
            let text = caseConverterInput.value;
            if (!text) return;

            switch (type) {
                case 'upper':
                    text = text.toUpperCase();
                    break;
                case 'lower':
                    text = text.toLowerCase();
                    break;
                case 'title':
                    text = text.toLowerCase().split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                    break;
                case 'sentence':
                    text = text.toLowerCase().replace(/(^\s*\w|[.!?]\s*\w)/g, c => c.toUpperCase());
                    break;
                case 'camel':
                    text = text.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g, (m, chr) => chr.toUpperCase());
                    text = text.charAt(0).toLowerCase() + text.slice(1); // Ensure first char is lower
                    break;
                case 'pascal':
                    text = text.toLowerCase().split(/[^a-zA-Z0-9]/).map(word => word.charAt(0).toUpperCase() + word.slice(1)).join('');
                    break;
                case 'clear':
                    text = '';
                    break;
            }
            caseConverterInput.value = text;
        }

        const counterInput = document.getElementById('counter-input');
        const charCountEl = document.getElementById('char-count');
        const wordCountEl = document.getElementById('word-count');
        const lineCountEl = document.getElementById('line-count');

        if (counterInput) {
            counterInput.addEventListener('input', function () {
                const text = this.value;
                charCountEl.textContent = text.length;
                wordCountEl.textContent = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
                // Count lines accurately, treating empty input as 0 lines, single line as 1
                lineCountEl.textContent = text === '' ? 0 : (text.match(/\n/g) || []).length + 1;
            });
        }

        const loremOutput = document.getElementById('lorem-output');
        const loremParagraphsInput = document.getElementById('lorem-paragraphs');
        const loremSentencesInput = document.getElementById('lorem-sentences');
        const loremStartCheckbox = document.getElementById('lorem-start');
        const loremIpsumBase = "Lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident sunt in culpa qui officia deserunt mollit anim id est laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium totam rem aperiam eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est qui dolorem ipsum quia dolor sit amet consectetur adipisci velit sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam quis nostrum exercitationem ullam corporis suscipit laboriosam nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?".split(' ');

        function generateLoremIpsum() {
            const numParagraphs = parseInt(loremParagraphsInput.value) || 3;
            const numSentences = parseInt(loremSentencesInput.value) || 5;
            const startWithLorem = loremStartCheckbox.checked;
            let result = '';

            for (let p = 0; p < numParagraphs; p++) {
                let paragraph = '';
                if (p === 0 && startWithLorem) {
                    paragraph = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. ";
                    // Generate remaining sentences for the first paragraph
                    for (let s = 1; s < numSentences; s++) {
                        paragraph += generateSentence() + " ";
                    }
                } else {
                    for (let s = 0; s < numSentences; s++) {
                        paragraph += generateSentence() + " ";
                    }
                }
                result += paragraph.trim() + (p < numParagraphs - 1 ? '\n\n' : ''); // Add paragraph break
            }
            loremOutput.textContent = result;
        }

        function generateSentence() {
            const sentenceLength = Math.floor(Math.random() * 10) + 8; // Random sentence length (8-17 words)
            let sentence = '';
            for (let i = 0; i < sentenceLength; i++) {
                sentence += loremIpsumBase[Math.floor(Math.random() * loremIpsumBase.length)] + " ";
            }
            // Capitalize first letter and add punctuation
            sentence = sentence.charAt(0).toUpperCase() + sentence.slice(1).trim() + '.';
            return sentence;
        }

        const diffOriginalInput = document.getElementById('diff-original');
        const diffChangedInput = document.getElementById('diff-changed');
        const diffOutput = document.getElementById('diff-output');

        function findTextDifferences() {
            const text1 = diffOriginalInput.value.split('\n');
            const text2 = diffChangedInput.value.split('\n');
            diffOutput.innerHTML = ''; // Clear previous diff

            if (!diffOriginalInput.value && !diffChangedInput.value) {
                diffOutput.textContent = "Please enter text in both fields.";
                return;
            }

            // Basic line-by-line comparison (not a true diff algorithm)
            const maxLength = Math.max(text1.length, text2.length);
            let hasDifferences = false;

            for (let i = 0; i < maxLength; i++) {
                const line1 = text1[i];
                const line2 = text2[i];

                if (line1 !== undefined && line2 === undefined) {
                    // Line removed
                    const div = document.createElement('div');
                    div.className = 'diff-remove';
                    div.textContent = `- ${line1}`;
                    diffOutput.appendChild(div);
                    hasDifferences = true;
                } else if (line1 === undefined && line2 !== undefined) {
                    // Line added
                    const div = document.createElement('div');
                    div.className = 'diff-add';
                    div.textContent = `+ ${line2}`;
                    diffOutput.appendChild(div);
                    hasDifferences = true;
                } else if (line1 !== line2) {
                    // Line changed (show both)
                    const divRemove = document.createElement('div');
                    divRemove.className = 'diff-remove';
                    divRemove.textContent = `- ${line1}`;
                    diffOutput.appendChild(divRemove);

                    const divAdd = document.createElement('div');
                    divAdd.className = 'diff-add';
                    divAdd.textContent = `+ ${line2}`;
                    diffOutput.appendChild(divAdd);
                    hasDifferences = true;
                } else {
                    // Line unchanged
                    const div = document.createElement('div');
                    div.textContent = `  ${line1}`; // Add spaces for alignment
                    diffOutput.appendChild(div);
                }
            }
            if (!hasDifferences && (diffOriginalInput.value || diffChangedInput.value)) {
                diffOutput.textContent = "No differences found.";
            }
        }


        // --- Image Tool Functions ---
        const compressorFileInput = document.getElementById('compressor-file-input');
        const compressorDropZone = document.getElementById('compressor-drop-zone');
        const compressorFileName = document.getElementById('compressor-file-name');
        const compressorOutput = document.getElementById('compressor-output');
        const compressButton = document.getElementById('compress-button');
        const qualitySlider = document.getElementById('quality-slider');
        const qualityValue = document.getElementById('quality-value');

        const converterFileInput = document.getElementById('converter-file-input');
        const converterDropZone = document.getElementById('converter-drop-zone');
        const converterFileName = document.getElementById('converter-file-name');
        const converterOutput = document.getElementById('converter-output');
        const convertButton = document.getElementById('convert-button');
        const converterTargetFormatInput = document.getElementById('converter-target-format');

        // Drag and Drop Setup
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            compressorDropZone?.addEventListener(eventName, preventDefaults, false);
            converterDropZone?.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false); // Prevent opening file in browser
        });
        ['dragenter', 'dragover'].forEach(eventName => {
            compressorDropZone?.addEventListener(eventName, () => compressorDropZone.classList.add('dragover'), false);
            converterDropZone?.addEventListener(eventName, () => converterDropZone.classList.add('dragover'), false);
        });
        ['dragleave', 'drop'].forEach(eventName => {
            compressorDropZone?.addEventListener(eventName, () => compressorDropZone.classList.remove('dragover'), false);
            converterDropZone?.addEventListener(eventName, () => converterDropZone.classList.remove('dragover'), false);
        });

        compressorDropZone?.addEventListener('drop', handleDropCompressor, false);
        converterDropZone?.addEventListener('drop', handleDropConverter, false);

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function handleDropCompressor(e) {
            let dt = e.dataTransfer;
            let files = dt.files;
            if (files.length > 0) {
                handleFileSelect(files[0], 'compressor');
            }
        }
        function handleDropConverter(e) {
            let dt = e.dataTransfer;
            let files = dt.files;
            if (files.length > 0) {
                handleFileSelect(files[0], 'converter');
            }
        }

        // Handle file selection (both input and drop)
        compressorFileInput?.addEventListener('change', (e) => handleFileSelect(e.target.files[0], 'compressor'));
        converterFileInput?.addEventListener('change', (e) => handleFileSelect(e.target.files[0], 'converter'));

        function handleFileSelect(file, type) {
            if (!file) return;

            if (type === 'compressor') {
                if (!['image/jpeg', 'image/png', 'image/webp'].includes(file.type)) {
                    alert('Please select a JPG, PNG, or WEBP file for compression.');
                    compressorFileInput.value = ''; // Reset input
                    return;
                }
                imageCompressorFile = file;
                compressorFileName.textContent = `Selected: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                compressButton.disabled = false;
                compressorOutput.innerHTML = ''; // Clear previous output
            } else if (type === 'converter') {
                if (!file.type.startsWith('image/')) {
                    alert('Please select a valid image file.');
                    converterFileInput.value = ''; // Reset input
                    return;
                }
                imageConverterFile = file;
                converterFileName.textContent = `Selected: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                convertButton.disabled = false;
                converterOutput.innerHTML = ''; // Clear previous output
            }
        }

        qualitySlider?.addEventListener('input', function () {
            qualityValue.textContent = this.value;
        });

        function processImage(file, options) {
            return new Promise((resolve, reject) => {
                if (!file) return reject('No file provided');

                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);

                        try {
                            const dataUrl = canvas.toDataURL(options.format, options.quality);
                            // Convert data URL to Blob for more accurate size info and download
                            fetch(dataUrl)
                                .then(res => res.blob())
                                .then(blob => resolve({ dataUrl, blob }))
                                .catch(reject);
                        } catch (error) {
                            console.error("Canvas toDataURL error:", error);
                            // Fallback for formats canvas might not support directly (like GIF preservation)
                            if (options.format === 'image/gif' && file.type === 'image/gif') {
                                console.warn("GIF conversion might lose animation. Returning original blob.");
                                resolve({ dataUrl: event.target.result, blob: file }); // return original if converting TO gif from gif
                            } else {
                                reject(`Error converting image: ${error.message}. Format may not be supported by browser.`);
                            }
                        }
                    };
                    img.onerror = (err) => reject('Failed to load image: ' + err);
                    img.src = event.target.result;
                };
                reader.onerror = (err) => reject('Failed to read file: ' + err);
                reader.readAsDataURL(file);
            });
        }


        async function compressImage() {
            if (!imageCompressorFile) {
                alert("Please select an image first.");
                return;
            }
            compressButton.disabled = true;
            compressorOutput.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Compressing...';

            const quality = parseInt(qualitySlider.value) / 100;
            const format = document.querySelector('input[name="compressFormat"]:checked').value;

            try {
                const { blob } = await processImage(imageCompressorFile, { format, quality });

                const originalSizeMB = (imageCompressorFile.size / 1024 / 1024).toFixed(2);
                const compressedSizeMB = (blob.size / 1024 / 1024).toFixed(2);
                const reduction = ((1 - blob.size / imageCompressorFile.size) * 100).toFixed(1);
                const downloadUrl = URL.createObjectURL(blob);
                const extension = format.split('/')[1]; // e.g., 'jpeg' or 'webp'

                compressorOutput.innerHTML = `
                     Original Size: ${originalSizeMB} MB<br>
                     Compressed Size: ${compressedSizeMB} MB (${reduction}% reduction)<br>
                     <a href="${downloadUrl}" download="compressed_${Date.now()}.${extension}" class="mt-2 inline-block px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition">
                         <i class="fas fa-download mr-2"></i> Download Compressed Image
                     </a>`;

            } catch (error) {
                console.error("Compression error:", error);
                compressorOutput.innerHTML = `<span class="text-red-600">Error: ${error}</span>`;
            } finally {
                compressButton.disabled = false;
            }
        }

        function setConversionFormat(format, buttonElement) {
            imageConverterFormat = format;
            converterTargetFormatInput.value = format; // Update hidden input if needed
            // Update button styles
            document.querySelectorAll('.convert-format-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-blue-50', 'text-blue-700', 'active');
                btn.classList.add('border-gray-300');
            });
            buttonElement.classList.add('border-blue-500', 'bg-blue-50', 'text-blue-700', 'active');
            buttonElement.classList.remove('border-gray-300');
        }

        async function convertImage() {
            if (!imageConverterFile) {
                alert("Please select an image first.");
                return;
            }
            convertButton.disabled = true;
            converterOutput.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Converting...';

            const targetFormat = imageConverterFormat;
            // Quality setting is not typically used for simple format conversion unless targeting lossy formats like jpg/webp
            const quality = (targetFormat === 'image/jpeg' || targetFormat === 'image/webp') ? 0.92 : undefined; // Use high quality default for lossy

            try {
                const { blob } = await processImage(imageConverterFile, { format: targetFormat, quality });

                const convertedSizeMB = (blob.size / 1024 / 1024).toFixed(2);
                const downloadUrl = URL.createObjectURL(blob);
                let extension = targetFormat.split('/')[1];
                if (extension === 'jpeg') extension = 'jpg'; // Common convention

                converterOutput.innerHTML = `
                     Converted Size: ${convertedSizeMB} MB<br>
                     Format: ${extension.toUpperCase()}<br>
                     <a href="${downloadUrl}" download="converted_${Date.now()}.${extension}" class="mt-2 inline-block px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition">
                         <i class="fas fa-download mr-2"></i> Download Converted Image
                     </a>`;

            } catch (error) {
                console.error("Conversion error:", error);
                converterOutput.innerHTML = `<span class="text-red-600">Error: ${error}</span>`;
            } finally {
                convertButton.disabled = false;
            }
        }


        // --- Data Tool Functions ---
        const jsonInput = document.getElementById('json-input');
        const csvOutput = document.getElementById('csv-output');
        const jsonCsvError = document.getElementById('json-csv-error');

        function loadSampleJson() {
            jsonInput.value = JSON.stringify([
                { "id": 1, "name": "Alice", "email": "alice@example.com", "city": "New York" },
                { "id": 2, "name": "Bob", "email": "bob@sample.net", "city": "London" },
                { "id": 3, "name": "Charlie", "email": "charlie@domain.org", "city": "Paris" }
            ], null, 2);
            jsonCsvError.textContent = '';
            csvOutput.textContent = 'CSV output will appear here...';
        }

        function convertJsonToCsv() {
            jsonCsvError.textContent = '';
            csvOutput.textContent = '';
            try {
                const jsonString = jsonInput.value.trim();
                if (!jsonString) {
                    jsonCsvError.textContent = 'JSON input is empty.';
                    return;
                }
                const data = JSON.parse(jsonString);

                if (!Array.isArray(data)) {
                    jsonCsvError.textContent = 'Input must be a JSON array of objects.';
                    return;
                }
                if (data.length === 0) {
                    csvOutput.textContent = 'JSON array is empty. No CSV generated.';
                    return;
                }

                // Get headers from the first object
                const headers = Object.keys(data[0]);
                let csvContent = headers.join(',') + '\n';

                // Add rows
                data.forEach(row => {
                    const values = headers.map(header => {
                        let value = row[header];
                        // Handle null/undefined and potential commas/newlines in values
                        if (value === null || value === undefined) {
                            value = '';
                        } else {
                            value = String(value);
                            // Quote the value if it contains comma, newline, or double quote
                            if (value.includes(',') || value.includes('\n') || value.includes('"')) {
                                value = `"${value.replace(/"/g, '""')}"`; // Escape double quotes
                            }
                        }
                        return value;
                    });
                    csvContent += values.join(',') + '\n';
                });

                csvOutput.textContent = csvContent.trim();

            } catch (error) {
                console.error("JSON to CSV Error:", error);
                jsonCsvError.textContent = `Invalid JSON: ${error.message}`;
                csvOutput.textContent = 'Error generating CSV.';
            }
        }

        const base64Input = document.getElementById('base64-input');
        const base64Output = document.getElementById('base64-output');
        const base64Error = document.getElementById('base64-error');

        function base64Encode() {
            base64Error.textContent = '';
            try {
                const text = base64Input.value;
                base64Output.value = btoa(unescape(encodeURIComponent(text))); // Handle UTF-8 correctly
            } catch (error) {
                console.error("Base64 Encode Error:", error);
                base64Error.textContent = `Encoding error: ${error.message}`;
                base64Output.value = '';
            }
        }

        function base64Decode() {
            base64Error.textContent = '';
            try {
                const base64 = base64Input.value.trim();
                if (!base64) {
                    base64Output.value = '';
                    return;
                }
                // Basic check for valid Base64 characters - refine if needed
                if (!/^[A-Za-z0-9+/=]*$/.test(base64) || base64.length % 4 !== 0) {
                    throw new Error("Input is not valid Base64");
                }
                base64Output.value = decodeURIComponent(escape(atob(base64))); // Handle UTF-8 correctly
            } catch (error) {
                console.error("Base64 Decode Error:", error);
                base64Error.textContent = `Decoding error: ${error.message}. Ensure input is valid Base64.`;
                base64Output.value = '';
            }
        }

        function swapBase64() {
            const inputVal = base64Input.value;
            const outputVal = base64Output.value;
            base64Input.value = outputVal;
            base64Output.value = inputVal;
            base64Error.textContent = ''; // Clear error on swap
        }


        // --- Security Tool Functions ---
        const generatedPasswordEl = document.getElementById('generated-password');
        const lengthSliderEl = document.getElementById('length-slider');
        const passwordLengthDisplayEl = document.getElementById('password-length-display');
        const pwOptUpper = document.getElementById('pw-opt-upper');
        const pwOptLower = document.getElementById('pw-opt-lower');
        const pwOptNumbers = document.getElementById('pw-opt-numbers');
        const pwOptSymbols = document.getElementById('pw-opt-symbols');
        const passwordStrengthIndicatorEl = document.getElementById('password-strength-indicator');

        const strengthCheckInput = document.getElementById('strength-check-input');
        const strengthResultsEl = document.getElementById('strength-results');
        const strengthInitialMessageEl = document.getElementById('strength-initial-message');
        const strengthTextEl = document.getElementById('strength-text');
        const strengthBarOverallEl = document.getElementById('strength-bar-overall');
        const strengthFeedbackEl = document.getElementById('strength-feedback');

        const charSets = {
            upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
            lower: 'abcdefghijklmnopqrstuvwxyz',
            numbers: '0123456789',
            symbols: '!@#$%^&*()_+-=[]{}|;:,.<>?'
        };

        function generatePassword(length, options) {
            let charset = '';
            if (options.upper) charset += charSets.upper;
            if (options.lower) charset += charSets.lower;
            if (options.numbers) charset += charSets.numbers;
            if (options.symbols) charset += charSets.symbols;

            if (charset === '') {
                return 'Select at least one character type!';
            }

            let password = '';
            // Ensure at least one char from each selected set if possible and length allows
            let guaranteedChars = '';
            if (options.upper) guaranteedChars += charSets.upper[Math.floor(Math.random() * charSets.upper.length)];
            if (options.lower) guaranteedChars += charSets.lower[Math.floor(Math.random() * charSets.lower.length)];
            if (options.numbers) guaranteedChars += charSets.numbers[Math.floor(Math.random() * charSets.numbers.length)];
            if (options.symbols) guaranteedChars += charSets.symbols[Math.floor(Math.random() * charSets.symbols.length)];

            // Shuffle guaranteed characters
            guaranteedChars = guaranteedChars.split('').sort(() => 0.5 - Math.random()).join('');


            // Fill remaining length
            const remainingLength = length - guaranteedChars.length;
            for (let i = 0; i < remainingLength; i++) {
                password += charset.charAt(Math.floor(Math.random() * charset.length));
            }

            // Combine and shuffle guaranteed with random
            password = (guaranteedChars + password).split('').sort(() => 0.5 - Math.random()).join('');

            // Truncate to exact length if guaranteed chars made it longer
            return password.slice(0, length);
        }

        function updatePasswordStrengthIndicator(password) {
            const score = calculatePasswordScore(password); // Use the same scoring as checker
            const bars = passwordStrengthIndicatorEl.querySelectorAll('.strength-bar');
            let strengthClass = 'bg-gray-300'; // Default
            let text = 'Weak';

            if (score >= 80) { strengthClass = 'bg-green-500'; text = 'Very Strong'; }
            else if (score >= 60) { strengthClass = 'bg-emerald-500'; text = 'Strong'; }
            else if (score >= 40) { strengthClass = 'bg-yellow-500'; text = 'Medium'; }
            else if (score > 0) { strengthClass = 'bg-red-500'; text = 'Weak'; }
            else { strengthClass = 'bg-gray-300'; text = 'Very Weak'; }


            // Update bars based on score
            bars.forEach((bar, index) => {
                bar.className = 'strength-bar w-3 h-1 mx-px rounded-full '; // Reset
                if (score >= (index + 1) * 25) { // 25, 50, 75, 100
                    bar.classList.add(strengthClass);
                } else {
                    bar.classList.add('bg-gray-300');
                }
            });
            // Could add a text label next to bars if desired:
            // passwordStrengthIndicatorEl.querySelector('span').textContent = text;
        }


        function generateAndDisplayPassword() {
            const length = parseInt(lengthSliderEl.value);
            const options = {
                upper: pwOptUpper.checked,
                lower: pwOptLower.checked,
                numbers: pwOptNumbers.checked,
                symbols: pwOptSymbols.checked
            };

            if (!options.upper && !options.lower && !options.numbers && !options.symbols) {
                generatedPasswordEl.textContent = 'Select options!';
                updatePasswordStrengthIndicator('');
                return;
            }

            const newPassword = generatePassword(length, options);
            generatedPasswordEl.textContent = newPassword;
            updatePasswordStrengthIndicator(newPassword); // Update strength indicator for generated password
        }

        if (lengthSliderEl) {
            lengthSliderEl.addEventListener('input', function () {
                passwordLengthDisplayEl.textContent = this.value;
                // Optionally regenerate on slider move, or wait for button click
                generateAndDisplayPassword(); // Regenerate on slide
            });
            // Add event listeners to checkboxes to regenerate password
            [pwOptUpper, pwOptLower, pwOptNumbers, pwOptSymbols].forEach(el => {
                el?.addEventListener('change', generateAndDisplayPassword);
            });
        }

        // Simple Password Strength Scoring Heuristic
        function calculatePasswordScore(password) {
            let score = 0;
            if (!password) return 0;

            // Length bonus
            score += Math.min(password.length * 3, 40); // Max 40 points for length (e.g., up to ~13 chars)

            // Character type bonus
            let types = 0;
            if (/[A-Z]/.test(password)) { types++; score += 10; }
            if (/[a-z]/.test(password)) { types++; score += 5; } // Lowercase slightly less bonus
            if (/[0-9]/.test(password)) { types++; score += 10; }
            if (/[^A-Za-z0-9]/.test(password)) { types++; score += 15; } // Symbols more bonus

            // Bonus for multiple types
            if (types > 2) score += types * 5; // Extra points for complexity

            // Penalty for only one type (simple passwords)
            if (types === 1 && password.length < 12) score -= 10;

            // Penalty for very short passwords regardless of complexity
            if (password.length < 8) score = Math.max(0, score - 20);

            return Math.max(0, Math.min(100, Math.round(score))); // Clamp score between 0 and 100
        }

        function getPasswordFeedback(password, score) {
            const feedback = [];
            const length = password.length;

            if (length < 8) feedback.push({ text: "â Too short (aim for 12+ characters).", type: 'bad' });
            else if (length < 12) feedback.push({ text: "â ï¸ Could be longer for better security.", type: 'warn' });
            else feedback.push({ text: "â Good length.", type: 'good' });

            let types = 0;
            let hasUpper = /[A-Z]/.test(password);
            let hasLower = /[a-z]/.test(password);
            let hasNumbers = /[0-9]/.test(password);
            let hasSymbols = /[^A-Za-z0-9]/.test(password);

            if (hasUpper) types++;
            if (hasLower) types++;
            if (hasNumbers) types++;
            if (hasSymbols) types++;

            if (!hasUpper) feedback.push({ text: "â ï¸ Add uppercase letters (A-Z).", type: 'warn' });
            if (!hasLower) feedback.push({ text: "â ï¸ Add lowercase letters (a-z).", type: 'warn' });
            if (!hasNumbers) feedback.push({ text: "â ï¸ Add numbers (0-9).", type: 'warn' });
            if (!hasSymbols) feedback.push({ text: "â ï¸ Add symbols (!@#$%).", type: 'warn' });

            if (types < 3 && length >= 8) feedback.push({ text: "â ï¸ Mix character types (letters, numbers, symbols) for complexity.", type: 'warn' });
            else if (types >= 3) feedback.push({ text: "â Good mix of character types.", type: 'good' });

            // Basic check for repeating chars (e.g., 'aaaa', '1111') - very simple
            if (/(.)\1{2,}/.test(password)) feedback.push({ text: "â ï¸ Avoid easily guessable repeating characters.", type: 'warn' });

            // Simple sequential check (e.g., 'abc', '123') - very simple
            if (/abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz/.test(password.toLowerCase())) feedback.push({ text: "â ï¸ Avoid sequential letters.", type: 'warn' });
            if (/123|234|345|456|567|678|789|890/.test(password)) feedback.push({ text: "â ï¸ Avoid sequential numbers.", type: 'warn' });

            return feedback;
        }

        function checkPasswordStrength() {
            const password = strengthCheckInput.value;
            strengthResultsEl.classList.add('hidden'); // Hide results initially
            strengthInitialMessageEl.classList.add('hidden');

            if (!password) {
                strengthInitialMessageEl.textContent = "Please enter a password to check.";
                strengthInitialMessageEl.classList.remove('hidden');
                return;
            }

            const score = calculatePasswordScore(password);
            const feedbackItems = getPasswordFeedback(password, score);

            // Update Bar
            let strengthClass = 'bg-red-500'; // Default weak
            let strengthText = 'Very Weak';
            if (score >= 80) { strengthClass = 'bg-green-500'; strengthText = 'Very Strong'; }
            else if (score >= 60) { strengthClass = 'bg-emerald-500'; strengthText = 'Strong'; }
            else if (score >= 40) { strengthClass = 'bg-yellow-500'; strengthText = 'Medium'; }
            else if (score > 0) { strengthClass = 'bg-red-500'; strengthText = 'Weak'; }

            strengthBarOverallEl.style.width = `${score}%`;
            strengthBarOverallEl.className = `h-2 rounded-full transition-all duration-300 ease-out ${strengthClass}`; // Apply color class
            strengthTextEl.textContent = strengthText;
            strengthTextEl.className = `text-sm font-semibold ${strengthClass.replace('bg-', 'text-').replace('-500', '-600')}`; // Match text color roughly

            // Update Feedback List
            strengthFeedbackEl.innerHTML = ''; // Clear previous feedback
            feedbackItems.forEach(item => {
                const p = document.createElement('p');
                p.textContent = item.text;
                if (item.type === 'bad') p.classList.add('text-red-600');
                else if (item.type === 'warn') p.classList.add('text-amber-600');
                else if (item.type === 'good') p.classList.add('text-green-600');
                else p.classList.add('text-gray-600');
                strengthFeedbackEl.appendChild(p);
            });

            strengthResultsEl.classList.remove('hidden'); // Show the results section
        }

        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', function () {
            // Set text tool as active by default if no hash exists
            if (!window.location.hash) {
                switchTool('text'); // Ensure text is default
            } else {
                // Allow linking directly to a tool, e.g., index.html#image
                const toolFromHash = window.location.hash.substring(1);
                const validTools = ['text', 'image', 'data', 'security', 'pdf'];
                if (validTools.includes(toolFromHash)) {
                    switchTool(toolFromHash);
                } else {
                    switchTool('text'); // Fallback to default
                }
            }

            // Initialize counter if text is already present (e.g., from browser cache)
            if (counterInput && counterInput.value) {
                counterInput.dispatchEvent(new Event('input'));
            }

            // Initialize password generator display
            if (lengthSliderEl) {
                passwordLengthDisplayEl.textContent = lengthSliderEl.value;
                generateAndDisplayPassword(); // Generate initial password
            }
            // Set initial active button style for converter
            setConversionFormat('image/png', document.querySelector('.convert-format-btn.active')); // Select PNG default visually

            // Add listener to password strength input
            strengthCheckInput?.addEventListener('input', checkPasswordStrength);

        });

        // Update tool based on hash changes
        window.addEventListener('hashchange', () => {
            const toolFromHash = window.location.hash.substring(1);
            const validTools = ['text', 'image', 'data', 'security', 'pdf'];
            if (validTools.includes(toolFromHash)) {
                switchTool(toolFromHash);
            }
        });


    </script>
</body>

</html>